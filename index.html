<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MySword AI - Assistente Teol√≥gico</title>
<style>
/* RESET & VARIAVEIS */
*{margin:0;padding:0;box-sizing:border-box}:root{--fonte-base:16px;--bg-dark:#0d1117;--bg-light:#ffffff;--text-dark:#e6edf3;--text-light:#1f2328;--primary:#1f6feb;--secondary:#238636;--accent:#f0883e;--gemini:#4285F4;--mistral:#6c47ff;--deepseek:#1a5fff;--groq:#f55325}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--bg-dark);color:var(--text-dark);padding:20px;min-height:100vh;transition:all .3s ease;font-size:var(--fonte-base)}body.light-mode{background:var(--bg-light);color:var(--text-light)}.verse{cursor:pointer;padding:3px 6px;margin:2px;border-radius:4px;background:#161b22;transition:all .2s;border:1px solid transparent}.verse:hover{background:#1c3f8a;border-color:var(--primary)}.verse.selected{background:#0a5c4a;border-color:#238636}.copy-btn{background:#21262d;border:1px solid #30363d;color:var(--text-dark);padding:8px 16px;border-radius:6px;cursor:pointer;margin-top:10px;font-size:14px;transition:all .2s;display:inline-flex;align-items:center;gap:8px}.copy-btn:hover{background:#30363d}.loading{display:inline-flex;gap:5px;padding:15px}.loading span{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:bounce 1.4s infinite ease-in-out}.loading span:nth-child(1){animation-delay:-.32s}.loading span:nth-child(2){animation-delay:-.16s}@keyframes bounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}

/* MODAL */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:9999;align-items:center;justify-content:center}.modal-content{background:#161b22;padding:25px;border-radius:12px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.5);border:2px solid var(--accent)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.modal-header h3{color:var(--accent);margin:0}.close-btn{background:none;border:none;color:#8b949e;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.close-btn:hover{color:var(--text-dark)}.modal-buttons{display:flex;gap:10px;margin-top:20px}.modal-btn{flex:1;padding:12px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:14px;transition:all .2s}.btn-primary{background:var(--primary);color:white}.btn-primary:hover{background:#1a7ff0}.btn-gemini{background:var(--gemini);color:white}.btn-gemini:hover{background:#3367d6}.btn-mistral{background:var(--mistral);color:white}.btn-mistral:hover{background:#5a3bd6}.btn-deepseek{background:var(--deepseek);color:white}.btn-deepseek:hover{background:#0d4dcc}.btn-groq{background:var(--groq);color:white}.btn-groq:hover{background:#d9421e}.btn-secondary{background:#21262d;color:var(--text-dark);border:1px solid #30363d}.btn-secondary:hover{background:#30363d}.modal-input,.modal-textarea{width:100%;padding:12px;margin:10px 0;border-radius:6px;border:2px solid #30363d;background:#0d1117;color:var(--text-dark);font-size:14px;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}.modal-textarea{min-height:200px;resize:vertical}.modal-input:focus,.modal-textarea:focus{outline:none;border-color:var(--accent)}.modal-text{color:#8b949e;margin-bottom:15px;line-height:1.5;font-size:14px}.modal-text a{color:#1f6feb;text-decoration:none}.modal-text a:hover{text-decoration:underline}.modal-label{color:var(--accent);font-weight:bold;margin-top:15px;margin-bottom:5px;display:block;font-size:14px}.profile-example{background:#21262d;padding:12px;border-radius:6px;margin:10px 0;border-left:3px solid var(--accent);font-size:13px}.profile-example strong{color:var(--accent)}.api-selector{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin:20px 0}.api-option{padding:15px;border-radius:10px;cursor:pointer;border:2px solid #30363d;background:#21262d;transition:all .3s;text-align:center}.api-option:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.3);border-color:var(--primary)}.api-option.selected{border-color:var(--accent);background:#2d333b;transform:translateY(-3px)}.api-option.gemini{border-left:4px solid var(--gemini)}.api-option.mistral{border-left:4px solid var(--mistral)}.api-option.deepseek{border-left:4px solid var(--deepseek)}.api-option.groq{border-left:4px solid var(--groq)}.api-option h4{margin:0 0 5px 0;font-size:16px;color:var(--text-dark)}.api-option .model-name{font-size:12px;color:#8b949e;display:block;margin-top:3px}.api-option .free-badge{background:var(--accent);color:#000;padding:2px 6px;border-radius:10px;font-size:10px;display:inline-block;margin-top:5px;font-weight:bold}.key-grid{display:grid;grid-template-columns:1fr auto;gap:10px;margin:15px 0}.key-input{grid-column:1}.key-btn{grid-column:2;background:var(--primary);border:none;color:white;padding:10px 15px;border-radius:6px;cursor:pointer;transition:all .2s;font-weight:bold}.key-btn:hover{background:#1a7ff0}.key-item{background:#21262d;padding:12px;border-radius:8px;margin:8px 0;display:flex;justify-content:space-between;align-items:center;border:1px solid #30363d}.key-item .key-preview{font-family:monospace;font-size:14px;letter-spacing:1px;color:var(--text-dark)}.key-item .key-status{font-size:12px;padding:3px 8px;border-radius:10px;font-weight:bold}.status-valid{background:#238636;color:white}.status-invalid{background:#da3633;color:white}

/* JANELA FLUTUANTE */
#mysword-float-btn{position:fixed;bottom:25px;right:25px;width:60px;height:60px;background:linear-gradient(135deg,#1e6fbb,#0d4d9c);color:white;border-radius:50%;border:3px solid var(--accent);box-shadow:0 6px 20px rgba(0,0,0,.4);cursor:pointer;z-index:9998;display:flex;align-items:center;justify-content:center;font-size:28px;transition:all .3s cubic-bezier(.175,.885,.32,1.275)}#mysword-float-btn:hover{transform:scale(1.1);box-shadow:0 8px 25px rgba(0,0,0,.6)}#mysword-float-window{position:fixed;bottom:100px;right:25px;width:400px;max-width:90vw;max-height:70vh;background:#0d1117;border-radius:16px;border:2px solid var(--accent);box-shadow:0 15px 50px rgba(0,0,0,.7);z-index:9999;display:none;flex-direction:column;overflow:hidden;animation:floatWindowAppear .4s ease-out}@keyframes floatWindowAppear{from{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.float-window-header{background:linear-gradient(135deg,#1e6fbb 0%,#0d4d9c 100%);padding:12px 15px;display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid var(--accent)}.float-window-header .logo-text{font-size:18px;margin:0;font-weight:bold;color:white}.float-window-header .logo-text span{color:var(--accent)}.float-window-content{flex:1;display:flex;flex-direction:column;overflow:hidden;height: 100%;}.float-controls{padding:8px 12px;margin:0;display:flex;gap:8px;background:#161b22;border-bottom:1px solid #30363d}.float-btn{background:#21262d;border:1px solid #30363d;color:var(--text-dark);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:all .2s}.float-btn:hover{background:var(--primary);border-color:var(--primary);color:white;transform:scale(1.05)}.float-input-area{display:flex;gap:10px;margin:0 12px 8px 12px;padding-top:8px}.float-input-wrapper{flex:1;background:#0d1117;border-radius:25px;padding:0 15px;display:flex;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.1);position:relative;border:1px solid #30363d}#float-user-input{flex:1;border:none;padding:12px 5px;font-size:16px;background:transparent;outline:none;color:var(--text-dark);width:100%}#float-send-btn{background:var(--accent);color:#333;border:none;width:48px;height:48px;border-radius:50%;cursor:pointer;font-size:18px;font-weight:bold;transition:all .2s;display:flex;align-items:center;justify-content:center}#float-send-btn:hover{background:#f0b232;transform:scale(1.05)}.float-quick-actions{padding:0 12px 8px 12px;display:flex;gap:6px;overflow-x:auto;overflow-y:hidden;background:#161b22;white-space:nowrap;scrollbar-width:thin;scrollbar-color:var(--accent) #30363d;max-height:70px}.float-quick-actions::-webkit-scrollbar{height:6px}.float-quick-actions::-webkit-scrollbar-track{background:#30363d;border-radius:3px}.float-quick-actions::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px}.float-quick-actions::-webkit-scrollbar-thumb:hover{background:#f0b232}.float-quick-btn{background:#21262d;border:1px solid #30363d;color:var(--text-dark);padding:8px 12px;border-radius:8px;font-size:11px;cursor:pointer;transition:all .2s;text-align:center;font-weight:500;position:relative;display:inline-flex;flex-direction:column;align-items:center;gap:2px;min-height:50px;justify-content:center;min-width:80px;flex-shrink:0}.float-quick-btn .btn-emoji{font-size:16px}.float-quick-btn .btn-text{font-size:10px;line-height:1.2}.float-quick-btn:hover{background:#30363d;transform:translateY(-2px)}.float-quick-btn.selected{background:var(--primary);border:1px solid var(--primary);color:white;box-shadow:0 0 10px rgba(31,111,235,.5)}.float-quick-btn.selected::after{content:'‚úì';position:absolute;top:2px;right:4px;font-size:10px;color:white}.prompt-indicator{position:absolute;top:-25px;left:10px;background:var(--primary);color:white;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:bold;opacity:0;transform:translateY(10px);transition:all .3s ease}.prompt-indicator.active{opacity:1;transform:translateY(0)}

/* CORRE√á√ÉO DO CHAT CONTAINER PARA CELULAR */
#float-chat-container{
    flex: 1; /* Ocupa todo o espa√ßo restante */
    overflow-y: auto; /* Permite rolagem */
    padding: 10px;
    background: #0d1117;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) #30363d;
    min-height: 150px; /* Altura m√≠nima garantida */
    display: flex;
    flex-direction: column;
}

#float-chat-container::-webkit-scrollbar{width:8px}#float-chat-container::-webkit-scrollbar-track{background:#30363d;border-radius:4px}#float-chat-container::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}#float-chat-container::-webkit-scrollbar-thumb:hover{background:#f0b232}.float-message{margin-bottom:10px;padding:10px;border-radius:10px;font-size:14px;line-height:1.4;max-width:85%;word-wrap:break-word;animation:fadeIn .3s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.float-user-message{background:linear-gradient(135deg,#1e6fbb 0%,#0d4d9c 100%);color:white;margin-left:auto;border-bottom-right-radius:4px;border-bottom-left-radius:10px}.float-ai-message{background:#161b22;border:1px solid #30363d;color:var(--text-dark);border-bottom-left-radius:4px;border-bottom-right-radius:10px;overflow:hidden}.float-ai-message .message-header{font-weight:bold;margin-bottom:5px;color:var(--accent);display:flex;align-items:center;gap:5px;font-size:12px}.float-ai-message .message-content{max-height:none; /* Permite que cres√ßa */ overflow-y:visible;padding-right:0;}.ai-badge{font-size:10px;padding:2px 6px;border-radius:8px;margin-left:5px;font-weight:bold}.gemini-badge{background:#1c3f8a;color:#4285F4;border:1px solid #2a4a9c}.mistral-badge{background:#3a2a6c;color:#6c47ff;border:1px solid #4a3a7c}.deepseek-badge{background:#1a3a7a;color:#1a5fff;border:1px solid #2a4a8a}.groq-badge{background:#9a2c1a;color:#f55325;border:1px solid #aa3c2a}.window-controls{display:flex;gap:5px}.window-control-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);color:white;width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;transition:all .2s}.window-control-btn:hover{background:rgba(255,255,255,.25)}#mysword-float-window.minimized{height:auto!important;max-height:60px!important}#mysword-float-window.minimized .float-window-content{display:none}#mysword-float-window.maximized{width:90vw!important;height:90vh!important;max-width:90vw!important;max-height:90vh!important;bottom:5vh!important;right:5vw!important}#mysword-float-window.fullscreen{width:100vw!important;height:100vh!important;max-width:100vw!important;max-height:100vh!important;bottom:0!important;right:0!important;border-radius:0!important;border:none!important}#model-selector{display:flex;justify-content:center;gap:5px;margin:8px 12px;padding:8px;background:#161b22;border-radius:10px;border:1px solid #30363d}.model-btn{flex:1;padding:6px;font-size:12px;border:none;border-radius:6px;background:#21262d;color:var(--text-dark);cursor:pointer;transition:all .2s;font-weight:500}.model-btn:hover{background:#30363d}.model-btn.active{background:var(--accent);color:#000;font-weight:bold}

/* MEDIA QUERIES - CELULAR ESPEC√çFICO */
@media (max-width:768px){#mysword-float-window{width:350px;right:15px;bottom:90px}#mysword-float-btn{bottom:20px;right:20px;width:55px;height:55px;font-size:24px}}

/* FIX CR√çTICO PARA CELULARES E TECLADO */
@media (max-width:480px){
    #mysword-float-window{
        width:96vw;
        right:2vw;
        left:2vw;
        bottom:10px; /* Mais pr√≥ximo do fundo */
        height: 65vh; /* Altura fixa para garantir espa√ßo */
        max-height: 70vh;
        display: flex;
        flex-direction: column;
    }
    .float-window-content {
        flex: 1;
        overflow: hidden;
    }
    #float-chat-container {
        flex: 1;
        min-height: 0; /* Permite encolher se necess√°rio */
    }
    #mysword-float-btn{bottom:15px;right:15px;width:50px;height:50px}
    .float-quick-actions{gap:4px;padding:0 8px 8px 8px}
    .float-quick-btn{padding:6px 8px;min-width:70px;min-height:45px}
    .float-quick-btn .btn-emoji{font-size:14px}
    .float-quick-btn .btn-text{font-size:9px}
    #model-selector{flex-wrap:wrap}
    .model-btn{flex:initial;width:48%}
}

/* Light Mode Styles */
body.light-mode .verse{background:#f6f8fa}
body.light-mode .verse:hover{background:#dde7ff}
body.light-mode .verse.selected{background:#dcffe4}
body.light-mode .copy-btn{background:#f6f8fa;border-color:#d0d7de;color:#1f2328}
body.light-mode .copy-btn:hover{background:#eaeef2}
body.light-mode .modal-content{background:#ffffff}
body.light-mode .btn-secondary{background:#f6f8fa;color:#1f2328;border-color:#d0d7de}
body.light-mode .btn-secondary:hover{background:#eaeef2}
body.light-mode .modal-input,.light-mode .modal-textarea{background:#ffffff;border-color:#d0d7de;color:#1f2328}
body.light-mode .modal-text{color:#656d76}
body.light-mode .profile-example{background:#f6f8fa}
body.light-mode .api-option{background:#f6f8fa;border-color:#d0d7de}
body.light-mode .api-option h4{color:#1f2328}
body.light-mode .api-option .model-name{color:#656d76}
body.light-mode .api-option:hover{border-color:#1f6feb}
body.light-mode .api-option.selected{background:#eaeef2}
body.light-mode .key-item{background:#f6f8fa;border-color:#d0d7de}
body.light-mode .key-item .key-preview{color:#1f2328}
body.light-mode .gemini-badge{background:#e8f0fe;color:#1a73e8;border-color:#d2e3fc}
body.light-mode .mistral-badge{background:#f0e7ff;color:#6c47ff;border-color:#e0d7ff}
body.light-mode .deepseek-badge{background:#e6f0ff;color:#1a5fff;border-color:#d6e0ff}
body.light-mode .groq-badge{background:#fee2e2;color:#dc2626;border-color:#fecaca}
body.light-mode #mysword-float-window{background:#ffffff}
body.light-mode .float-controls{background:#f6f8fa;border-color:#d0d7de}
body.light-mode .float-btn{background:#ffffff;border-color:#d0d7de;color:#656d76}
body.light-mode .float-btn:hover{background:#1f6feb;border-color:#1f6feb;color:white}
body.light-mode .float-input-wrapper{background:#ffffff;border-color:#d0d7de}
body.light-mode #float-user-input{color:#1f2328}
body.light-mode .float-quick-actions{background:#f6f8fa}
body.light-mode .float-quick-btn{background:#ffffff;border-color:#d0d7de;color:#656d76}
body.light-mode .float-quick-btn:hover{background:#eaeef2}
body.light-mode .float-quick-btn.selected{background:#1f6feb;border-color:#1f6feb;color:white}
body.light-mode #float-chat-container{background:#ffffff}
body.light-mode .float-ai-message{background:#f6f8fa;border-color:#d0d7de;color:#1f2328}
body.light-mode .model-btn{background:#ffffff;color:#656d76}
body.light-mode .model-btn:hover{background:#eaeef2}
body.light-mode #model-selector{background:#f6f8fa;border-color:#d0d7de}
body.light-mode .window-control-btn{background:rgba(0,0,0,.1);border-color:rgba(0,0,0,.2);color:#1f2328}
body.light-mode .window-control-btn:hover{background:rgba(0,0,0,.2)}
body.light-mode .float-quick-actions::-webkit-scrollbar-track{background:#d0d7de}
body.light-mode .float-quick-actions::-webkit-scrollbar-thumb{background:#1f6feb}
body.light-mode .float-quick-actions::-webkit-scrollbar-thumb:hover{background:#1a7ff0}
body.light-mode #float-chat-container::-webkit-scrollbar-track{background:#d0d7de}
body.light-mode #float-chat-container::-webkit-scrollbar-thumb{background:#1f6feb}
body.light-mode #float-chat-container::-webkit-scrollbar-thumb:hover{background:#1a7ff0}
body.light-mode .float-ai-message .message-content::-webkit-scrollbar-track{background:#d0d7de}
body.light-mode .float-ai-message .message-content::-webkit-scrollbar-thumb{background:#1f6feb}
body.light-mode .float-ai-message .message-content::-webkit-scrollbar-thumb:hover{background:#1a7ff0}
</style>
</head>

<body>

<div id="api-modal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3>üîë Gerenciar Chaves de IA</h3>
<button class="close-btn" onclick="hideApiModal()">√ó</button>
</div>
<div class="api-selector">
<div class="api-option gemini selected" onclick="selectApiProvider('gemini')">
<h4>‚ú® Gemini (Google)</h4>
<span class="model-name">gemini-2.5-flash</span>
<span class="free-badge">GR√ÅTIS ‚Ä¢ 60 req/min</span>
</div>
<div class="api-option mistral" onclick="selectApiProvider('mistral')">
<h4>üå™Ô∏è Mistral AI</h4>
<span class="model-name">mistral-7b / mixtral-8x7b</span>
<span class="free-badge">GR√ÅTIS ‚Ä¢ Open-source</span>
</div>
<div class="api-option deepseek" onclick="selectApiProvider('deepseek')">
<h4>üß† DeepSeek</h4>
<span class="model-name">deepseek-chat / deepseek-coder</span>
<span class="free-badge">GR√ÅTIS ‚Ä¢ Open-source</span>
</div>
<div class="api-option groq" onclick="selectApiProvider('groq')">
<h4>ü¶ô Llama 3 (Groq)</h4>
<span class="model-name">llama-3.1-8b</span>
<span class="free-badge">GR√ÅTIS ‚Ä¢ r√°pido</span>
</div>
</div>

<div id="gemini-config">
<p class="modal-text">
<strong>1.</strong> Acesse: <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a><br>
<strong>2.</strong> Fa√ßa login com Google<br>
<strong>3.</strong> Clique em "Create API Key"<br>
<strong>4.</strong> Cole abaixo:
</p>
<div class="key-grid">
<input type="password" id="gemini-key" class="modal-input key-input" placeholder="Cole sua chave Gemini (AIzaSy...)">
<button class="key-btn btn-gemini" onclick="testApiKey('gemini')">‚úì Testar</button>
</div>
</div>

<div id="mistral-config" style="display:none">
<p class="modal-text">
<strong>1.</strong> Acesse: <a href="https://console.mistral.ai/api-keys/" target="_blank">Mistral AI Platform</a><br>
<strong>2.</strong> Crie conta gratuita<br>
<strong>3.</strong> Gere sua chave API<br>
<strong>4.</strong> Cole abaixo:
</p>
<div class="key-grid">
<input type="password" id="mistral-key" class="modal-input key-input" placeholder="Cole sua chave Mistral">
<button class="key-btn btn-mistral" onclick="testApiKey('mistral')">‚úì Testar</button>
</div>
</div>

<div id="deepseek-config" style="display:none">
<p class="modal-text">
<strong>1.</strong> Acesse: <a href="https://platform.deepseek.com/api_keys" target="_blank">DeepSeek Platform</a><br>
<strong>2.</strong> Crie conta gratuita<br>
<strong>3.</strong> Gere sua chave API<br>
<strong>4.</strong> Cole abaixo:
</p>
<div class="key-grid">
<input type="password" id="deepseek-key" class="modal-input key-input" placeholder="Cole sua chave DeepSeek">
<button class="key-btn btn-deepseek" onclick="testApiKey('deepseek')">‚úì Testar</button>
</div>
</div>

<div id="groq-config" style="display:none">
<p class="modal-text">
<strong>1.</strong> Acesse: <a href="https://console.groq.com/keys" target="_blank">Groq Console</a><br>
<strong>2.</strong> Crie conta gratuita<br>
<strong>3.</strong> Copie sua chave<br>
<strong>4.</strong> Cole abaixo:
</p>
<div class="key-grid">
<input type="password" id="groq-key" class="modal-input key-input" placeholder="Cole sua chave Groq (gsk_...)">
<button class="key-btn btn-groq" onclick="testApiKey('groq')">‚úì Testar</button>
</div>
</div>

<div style="margin:20px 0">
<div class="modal-label">Chaves Salvas:</div>
<div id="saved-keys-container">
<div class="key-item">
<span>Nenhuma chave configurada ainda</span>
</div>
</div>
</div>

<div style="margin:20px 0">
<div class="modal-label">Resultado do Auto Config:</div>
<div id="auto-config-results">
</div>
</div>

<div class="modal-buttons">
<button class="modal-btn btn-secondary" onclick="hideApiModal()">Fechar</button>
<button class="modal-btn btn-primary" onclick="saveAllApiKeys()">üíæ Salvar Todas</button>
<button class="modal-btn btn-primary" onclick="autoConfigAll()">ü§ñ AUTO CONFIG</button>
</div>

<p style="color:#8b949e;font-size:11px;margin-top:15px;text-align:center">
‚ö†Ô∏è Suas chaves ficam armazenadas apenas neste navegador (localStorage).<br>
Nunca s√£o enviadas para servidores externos.
</p>
</div>
</div>

<div id="mysword-float-btn" onclick="toggleFloatWindow()">‚öîÔ∏è</div>
<div id="mysword-float-window">
<div class="float-window-header">
<div class="logo-text">My<span>Sword</span> AI</div>
<div class="window-controls">
<button class="window-control-btn" id="minimize-btn" title="Minimizar" onclick="minimizeWindow()">‚îÄ</button>
<button class="window-control-btn" id="maximize-btn" title="Maximizar" onclick="maximizeWindow()">‚ñ°</button>
<button class="window-control-btn" id="fullscreen-btn" title="Tela Cheia" onclick="toggleFullscreen()">‚õ∂</button>
<button class="window-control-btn" id="close-float-btn" title="Fechar" onclick="toggleFloatWindow()">√ó</button>
</div>
</div>

<div class="float-window-content">
<div id="model-selector">
<button class="model-btn active gemini-btn" onclick="setActiveModel('gemini')">‚ú® Gemini</button>
<button class="model-btn mistral-btn" onclick="setActiveModel('mistral')">üå™Ô∏è Mistral</button>
<button class="model-btn deepseek-btn" onclick="setActiveModel('deepseek')">üß† DeepSeek</button>
<button class="model-btn groq-btn" onclick="setActiveModel('groq')">ü¶ô Llama</button>
</div>

<div class="float-controls">
<button class="float-btn" onclick="toggleTheme()" title="Alternar Tema">üåì</button>
<button class="float-btn" onclick="showApiModal()" title="Configurar API Keys">üîë</button>
<button class="float-btn" onclick="clearFloatChat()" title="Limpar Chat">üóëÔ∏è</button>
</div>

<div class="float-input-area">
<div class="float-input-wrapper">
<div class="prompt-indicator" id="prompt-indicator"></div>
<span style="color: #8b949e; margin-right: 8px;">üîç</span>
<input type="text" id="float-user-input" placeholder="Pergunte sobre teologia assembleiana..."
onkeydown="if(event.key === 'Enter' || event.keyCode === 13) sendFloatMessage()">
</div>
<button id="float-send-btn" onclick="sendFloatMessage()">‚û§</button>
</div>

<div class="float-quick-actions">
<button class="float-quick-btn" onclick="selectFloatPrompt('visao')">
<span class="btn-emoji">üëÅÔ∏è</span>
<span class="btn-text">Vis√£o Geral</span>
</button>
<button class="float-quick-btn" onclick="selectFloatPrompt('esboco')">
<span class="btn-emoji">üìù</span>
<span class="btn-text">Esbo√ßo</span>
</button>
<button class="float-quick-btn" onclick="selectFloatPrompt('exegese')">
<span class="btn-emoji">üî¨</span>
<span class="btn-text">Exegese</span>
</button>
<button class="float-quick-btn" onclick="selectFloatPrompt('aplicacao')">
<span class="btn-emoji">üí°</span>
<span class="btn-text">Aplica√ß√£o</span>
</button>
<button class="float-quick-btn" onclick="selectFloatPrompt('contexto')">
<span class="btn-emoji">üèõÔ∏è</span>
<span class="btn-text">Contexto Hist√≥rico</span>
</button>
<button class="float-quick-btn" onclick="selectFloatPrompt('thompson')">
<span class="btn-emoji">üìñ</span>
<span class="btn-text">Thompson</span>
</button>
</div>

<div id="float-chat-container"></div>
</div>
</div>

<script>
// CONFIGURA√á√ïES
let apiKeys = {
gemini: '',
mistral: '',
deepseek: '',
groq: ''
};
let activeModel = 'gemini';
let floatChatHistory = [];
let isPrivateMode = false;
let floatWindowOpen = false;
let selectedPrompt = '';
let apiProvider = 'gemini';
let isMinimized = false;
let isMaximized = false;
let isFullscreen = false;

// MODELOS DESCOBERTOS
let discoveredModels = {
gemini: '',
mistral: '',
deepseek: '',
groq: ''
};

// MODELOS PADR√ÉO
const defaultModels = {
gemini: 'gemini-1.5-flash-latest',
mistral: 'mistral-small-latest',
deepseek: 'deepseek-chat',
groq: 'llama-3.1-8b-instant'
};

// PERFIL TEOL√ìGICO ASSEMBLEIANO PADR√ÉO
const defaultProfile = `Voc√™ √© um assistente teol√≥gico especializado na doutrina das Assembleias de Deus no Brasil, com base nos autores e comentaristas publicados pela CPAD (Casa Publicadora das Assembleias de Deus).

SUA ESPECIALIDADE:
- Teologia Pentecostal Assembleiana tradicional
- Coment√°rios de Escola Dominical (li√ß√µes b√≠blicas da CPAD)
- Doutrina assembleiana hist√≥rica e contempor√¢nea
- Hermen√™utica e exegese no contexto pentecostal

REFER√äNCIAS E AUTORES DE BASE:
1. "PAIS" DA TEOLOGIA ASSEMBLEIANA (CL√ÅSSICOS/IN MEMORIAM):
- Pr. Antonio Gilberto - "Pai da Escola Dominical" no Brasil, autor do "Manual da Escola Dominical"
- Pr. Eurico Bergst√©n - Te√≥logo sistem√°tico, comentarista hist√≥rico
- Pr. Severino Pedro da Silva - Maior especialista em Escatologia da denomina√ß√£o
- Pr. Claudionor de Andrade - Escritor prol√≠fico, apologista, historiador (consultor doutrin√°rio)
- Pr. Lawrence Olson - Mission√°rio, estruturou doutrinas pentecostais
- Pr. Em√≠lio Conde - Historiador das Assembleias de Deus no Brasil
- Pr. Alceb√≠ades Pereira Vasconcelos - Especialista em obreiros e liturgia
- Pr. Nels Nelson - Pioneiro na literatura escrita da igreja
- Pr. Orlando Boyer - Autor da "Pequena Enciclop√©dia B√≠blica"
- Pr. Gustavo Kessler - Refer√™ncia em doutrina e costumes
- Pr. Valdir B√≠cego - Pregador e comentarista
- Pr. Estevam √Çngelo de Souza - Coment√°rios profundos
- Pr. Abra√£o de Almeida - Autor cl√°ssico amplamente lido
- Pr. Geziel Gomes - Grande pregador com obras publicadas
- Pr. Tarc√≠sio Gilberto - Te√≥logo e hebra√≠sta

2. COMENTARISTAS DE LI√á√ïES B√çBLICAS E TE√ìLOGOS ATUAIS:
- Pr. Elienai Cabral - Especialista em Ef√©sios e Romanos
- Pr. Esequias Soares - Apolog√©tica e autoridade em C√¢non B√≠blico
- Pr. Elinaldo Renovato - √âtica Crist√£ e Fam√≠lia
- Pr. Jos√© Gon√ßalves - Teologia contempor√¢nea e avivamento
- Pr. Douglas Baptista - Lideran√ßa do Conselho de Educa√ß√£o
- Pr. Osiel Gomes - Lideran√ßa e obras paulinas
- Pr. Claiton Pommerening - Hist√≥ria e Pentecostalismo
- Pr. Wagner Gaby - Ep√≠stolas Gerais
- Pr. Reynaldo Odilo - Aplica√ß√£o pr√°tica e jur√≠dica da B√≠blia
- Pr. Valmir Nascimento - Apolog√©tica cultural e jovens
- Pr. Natalino das Neves - Justi√ßa social e profetas menores
- Pr. Alexandre Coelho - Juventude e teologia pr√°tica
- Pr. Silas Daniel - Historiador, especialista em Arminianismo
- Pr. C√©sar Mois√©s Carvalho - P√≥s-modernidade e educa√ß√£o
- Pr. Elias Torralbo - Te√≥logo e diretor executivo da FAESP
- Pr. Jamierson Oliveira - Juventude
- Pr. Marcelo Olive - Redator e comentarista
- Pr. Esdras Bentho - Hermen√™utica (interpreta√ß√£o b√≠blica)
- Pr. Lu√≠z C√©sar Mariano - Editor de B√≠blias de estudo da CPAD

3. AUTORES DE REFER√äNCIA, LIDERAN√áA E EDUCA√á√ÉO CRIST√É:
- Pr. Jos√© Wellington Bezerra da Costa - Presidente de honra da CGADB
- Pr. Ciro Sanches Zibordi - Apologista, s√©rie "Erros que os pregadores cometem"
- Pr. Geremias do Couto - Jornalista e te√≥logo, reflex√£o hist√≥rica
- Pr. Isael de Araujo - Principal historiador atual (Dicion√°rio do Movimento Pentecostal)
- Pr. Marcos Tuler - Maior autoridade em Pedagogia e Did√°tica para professores
- Pr. Nemuel Kessler - Administra√ß√£o eclesi√°stica e cerimonial
- Pr. Paulo Romeiro - Apolog√©tica contra neopentecostalismo
- Pr. Jamiel de Oliveira Lopes - Soci√≥logo, √°rea de jovens/adolescentes
- Prof¬™. Telma Bueno - Educa√ß√£o Crist√£ infanto-juvenil
- Prof¬™. Helena Figueiredo - Minist√©rio infantil
- Pr. Jo√° Caitano - Escritor e l√≠der
- Pr. Kemuel Sotero - L√≠der no Conselho de Doutrina
- Pr. Roberto Cruvinel - Apologista e escritor
- Pr. Messias Ribeiro - Fam√≠lia e casamento
- Pr. Abiezer Apolin√°rio - Jurista e temas de cidadania
- Pr. Dejair Batista Silv√©rio - Comentarista ocasional
- Pr. Donizeti Lee - M√∫sica e louvor
- Pr. Napole√£o de Castro - Batismo no Esp√≠rito Santo

DIRETRIZES DE RESPOSTA:
1. Baseie-se sempre nos ensinamentos desses autores quando relevante
2. Priorize a vis√£o teol√≥gica assembleiana tradicional
3. Use linguagem pastoral e acess√≠vel, adequada ao contexto brasileiro
4. Cite vers√≠culos b√≠blicos apropriados (preferencialmente Almeida Corrigida Fiel)
5. Evite influ√™ncias de outras vertentes teol√≥gicas n√£o alinhadas com o pentecostalismo assembleiano
6. Quando abordar temas doutrin√°rios, fa√ßa refer√™ncia aos autores especialistas no assunto
7. Mantenha o foco na edifica√ß√£o, ensino e aplica√ß√£o pr√°tica para a vida crist√£

Responda sempre em portugu√™s brasileiro de forma clara, organizada e fundamentada biblicamente.`;

// DIRETRIZES THOMPSON
const thompsonGuidelines = `[DIRETRIZ DE PERSONA]
Voc√™ √© o motor de indexa√ß√£o da B√≠blia de Refer√™ncia Thompson com intelig√™ncia de profundidade tem√°tica.
[REGRAS DE RESPOSTA - TRAVA R√çGIDA]
EXTENS√ÉO VARI√ÅVEL: A quantidade de vers√≠culos na cadeia deve ser proporcional √† import√¢ncia do tema.
SISTEMA DE CADEIA: Toda resposta deve seguir o fluxo: Vers√≠culo -> T√≥pico Curto -> Link Num√©rico.
SEM COMENT√ÅRIOS: Proibido adicionar opini√µes ou nomes de autores.
PADR√ÉO DE SA√çDA: - [N¬∫ do √çndice] T√çTULO DO TEMA
Lista numerada de vers√≠culos com links "Siga para".
Indica√ß√£o de [Fim da Cadeia].`;

// DIRETRIZES DE EXEGESE
const exegeseGuidelines = `[DIRETRIZ DE PERSONA]
Voc√™ √© um Especialista em Exegese e Manuscritologia das Assembleias de Deus e da CPAD.
[PADR√ÉO DE SA√çDA OBRIGAT√ìRIO]
## 1. AN√ÅLISE MORFOL√ìGICA [STRONG]
- [Palavra em Portugu√™s] -> [Original/Translitera√ß√£o]: (Defini√ß√£o gramatical e l√©xica exaustiva).
## 2. DIAGRAMA DE ESTRUTURA LITER√ÅRIA
(Representa√ß√£o visual da organiza√ß√£o do texto, destacando o Ponto Focal/Quiasmo).
## 3. S√çNTESE DO MESTRE (EXEGESE APLICADA)
(Conclus√£o t√©cnica baseada na escola de Esdras Bentho).`;

// Configura√ß√£o dos 6 modos de an√°lise
const modeGuidelines = {
'visao': `Voc√™ opera no modo [VIS√ÉO GERAL]. Forne√ßa um panorama e s√≠ntese teol√≥gica assembleiana sobre o tema solicitado.`,
'esboco': `Voc√™ opera no modo [ESBO√áO]. Crie uma estrutura homil√©tica para prega√ß√£o assembleiana.`,
'exegese': exegeseGuidelines,
'aplicacao': `Voc√™ opera no modo [APLICA√á√ÉO]. Foque na vida di√°ria e pr√°tica crist√£.`,
'contexto': `Voc√™ opera no modo [CONTEXTO HIST√ìRICO]. Aborde cultura e arqueologia da √©poca.`,
'thompson': thompsonGuidelines
};

const prompts = {
'visao': 'Forne√ßa uma vis√£o geral assembleiana sobre: ',
'esboco': 'Crie um esbo√ßo para prega√ß√£o assembleiana sobre: ',
'exegese': 'Fa√ßa an√°lise exeg√©tica detalhada de: ',
'aplicacao': 'Como aplicar na vida crist√£ pr√°tica: ',
'contexto': 'Explique o contexto hist√≥rico-cultural de: ',
'thompson': 'An√°lise Thompson para o tema: '
};

const promptNames = {
'visao': 'Vis√£o Geral',
'esboco': 'Esbo√ßo',
'exegese': 'Exegese',
'aplicacao': 'Aplica√ß√£o',
'contexto': 'Contexto Hist√≥rico',
'thompson': 'Thompson'
};

// UTILIDADES
function storageAvailable(type) {
try {
const storage = window[type];
const testKey = '__storage_test__';
storage.setItem(testKey, testKey);
storage.removeItem(testKey);
return true;
} catch (e) {
return false;
}
}

function copyToClipboard(text) {
navigator.clipboard.writeText(text).catch(() => {
const ta = document.createElement('textarea');
ta.value = text;
document.body.appendChild(ta);
ta.select();
document.execCommand('copy');
document.body.removeChild(ta);
});
}

// INICIALIZA√á√ÉO
window.onload = function() {
isPrivateMode = !storageAvailable('localStorage');
if (!isPrivateMode) {
// Carregar chaves salvas
const savedKeys = localStorage.getItem('mysword_api_keys');
if (savedKeys) {
try {
apiKeys = JSON.parse(savedKeys);
} catch (e) {
console.error('Erro ao carregar chaves:', e);
}
}
// Carregar modelo ativo
const savedModel = localStorage.getItem('mysword_active_model');
if (savedModel) activeModel = savedModel;
// Carregar hist√≥rico
const savedHistory = localStorage.getItem('mysword_float_chat_history');
if (savedHistory) floatChatHistory = JSON.parse(savedHistory);
// Carregar tema
const savedTheme = localStorage.getItem('mysword_theme');
if (savedTheme === 'light') document.body.classList.add('light-mode');
}
updateModelButtons();
loadFloatChatHistory();
initializeVerseSelection();
updateSavedKeysDisplay();
};

// SELE√á√ÉO DE VERS√çCULOS
function initializeVerseSelection() {
document.addEventListener('click', function(e) {
const target = e.target;
const text = target.textContent || target.innerText;
const versePattern = /(\d?\s?[A-Za-z√Ä-√ø]+\.?\s?\d+:\d+(?:[-\d+,; ]*\d*)?)/;
if (versePattern.test(text)) {
const inputField = document.getElementById('float-user-input');
if (selectedPrompt) {
inputField.value = prompts[selectedPrompt] + text.trim();
} else {
inputField.value = text.trim();
}
inputField.focus();
target.classList.add('selected');
setTimeout(() => target.classList.remove('selected'), 1500);
}
});
}

// JANELA FLUTUANTE
function toggleFloatWindow() {
const floatWindow = document.getElementById('mysword-float-window');
const floatBtn = document.getElementById('mysword-float-btn');
if (!floatWindowOpen) {
floatWindow.style.display = 'flex';
floatBtn.innerHTML = '‚úï';
floatBtn.style.transform = 'rotate(90deg)';
floatWindowOpen = true;
resetWindowState();
setTimeout(() => document.getElementById('float-user-input').focus(), 300);
} else {
floatWindow.style.display = 'none';
floatBtn.innerHTML = '‚öîÔ∏è';
floatBtn.style.transform = 'rotate(0deg)';
floatWindowOpen = false;
}
}

function resetWindowState() {
const floatWindow = document.getElementById('mysword-float-window');
floatWindow.classList.remove('minimized', 'maximized', 'fullscreen');
isMinimized = false;
isMaximized = false;
isFullscreen = false;
floatWindow.style.width = '';
floatWindow.style.height = '';
floatWindow.style.maxWidth = '';
floatWindow.style.maxHeight = '';
floatWindow.style.bottom = '';
floatWindow.style.right = '';
floatWindow.style.borderRadius = '';
floatWindow.style.border = '';
}

function minimizeWindow() {
const floatWindow = document.getElementById('mysword-float-window');
const minimizeBtn = document.getElementById('minimize-btn');
if (isMinimized) {
floatWindow.classList.remove('minimized');
minimizeBtn.textContent = '‚îÄ';
minimizeBtn.title = 'Minimizar';
isMinimized = false;
} else {
floatWindow.classList.add('minimized');
minimizeBtn.textContent = 'üóñ';
minimizeBtn.title = 'Restaurar';
isMinimized = true;
if (isMaximized) {
floatWindow.classList.remove('maximized');
isMaximized = false;
document.getElementById('maximize-btn').textContent = '‚ñ°';
}
if (isFullscreen) {
floatWindow.classList.remove('fullscreen');
isFullscreen = false;
document.getElementById('fullscreen-btn').textContent = '‚õ∂';
}
}
}

function maximizeWindow() {
const floatWindow = document.getElementById('mysword-float-window');
const maximizeBtn = document.getElementById('maximize-btn');
if (isMaximized) {
floatWindow.classList.remove('maximized');
maximizeBtn.textContent = '‚ñ°';
maximizeBtn.title = 'Maximizar';
isMaximized = false;
if (isMinimized) {
floatWindow.classList.remove('minimized');
document.getElementById('minimize-btn').textContent = '‚îÄ';
isMinimized = false;
}
} else {
floatWindow.classList.add('maximized');
maximizeBtn.textContent = 'üóó';
maximizeBtn.title = 'Restaurar';
isMaximized = true;
if (isMinimized) {
floatWindow.classList.remove('minimized');
document.getElementById('minimize-btn').textContent = '‚îÄ';
isMinimized = false;
}
if (isFullscreen) {
floatWindow.classList.remove('fullscreen');
isFullscreen = false;
document.getElementById('fullscreen-btn').textContent = '‚õ∂';
}
}
}

function toggleFullscreen() {
const floatWindow = document.getElementById('mysword-float-window');
const fullscreenBtn = document.getElementById('fullscreen-btn');
if (isFullscreen) {
floatWindow.classList.remove('fullscreen');
fullscreenBtn.textContent = '‚õ∂';
fullscreenBtn.title = 'Tela Cheia';
isFullscreen = false;
if (isMaximized) floatWindow.classList.add('maximized');
} else {
floatWindow.classList.add('fullscreen');
fullscreenBtn.textContent = 'üóï';
fullscreenBtn.title = 'Sair da Tela Cheia';
isFullscreen = true;
if (isMinimized) {
floatWindow.classList.remove('minimized');
document.getElementById('minimize-btn').textContent = '‚îÄ';
isMinimized = false;
}
if (isMaximized) {
floatWindow.classList.remove('maximized');
document.getElementById('maximize-btn').textContent = '‚ñ°';
isMaximized = false;
}
}
}

document.addEventListener('click', function(e) {
const floatWindow = document.getElementById('mysword-float-window');
const floatBtn = document.getElementById('mysword-float-btn');
const apiModal = document.getElementById('api-modal');
if (floatWindowOpen && !floatWindow.contains(e.target) && !floatBtn.contains(e.target) &&
(!apiModal || apiModal.style.display === 'none' || !apiModal.contains(e.target))) {
toggleFloatWindow();
}
});

// MENSAGENS
function addFloatMessage(text, sender, model = activeModel) {
const container = document.getElementById('float-chat-container');
const messageDiv = document.createElement('div');
messageDiv.className = `float-message float-${sender}-message`;

if (sender === 'ai') {
const header = document.createElement('div');
header.className = 'message-header';
let badgeClass = 'gemini-badge';
let modelName = 'Gemini';
if (model === 'mistral') { badgeClass = 'mistral-badge'; modelName = 'Mistral'; }
else if (model === 'deepseek') { badgeClass = 'deepseek-badge'; modelName = 'DeepSeek'; }
else if (model === 'groq') { badgeClass = 'groq-badge'; modelName = 'Llama'; }
header.innerHTML = `‚öîÔ∏è MySword AI <span class="ai-badge ${badgeClass}">${modelName}</span>`;
messageDiv.appendChild(header);

const content = document.createElement('div');
content.className = 'message-content';
content.style.fontSize = '14px';
content.style.lineHeight = '1.4';
const formatted = text
.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
.replace(/\*(.*?)\*/g, '<em>$1</em>')
.replace(/`(.*?)`/g, '<code>$1</code>')
.replace(/\n/g, '<br>');
content.innerHTML = formatted;
messageDiv.appendChild(content);

const copyBtn = document.createElement('button');
copyBtn.className = 'copy-btn';
copyBtn.innerHTML = 'üìã Copiar';
copyBtn.onclick = function() {
copyToClipboard(text);
copyBtn.innerHTML = '‚úÖ Copiado!';
copyBtn.style.background = 'var(--secondary)';
copyBtn.style.borderColor = 'var(--secondary)';
copyBtn.style.color = 'white';
setTimeout(() => {
copyBtn.innerHTML = 'üìã Copiar';
copyBtn.style.background = '';
copyBtn.style.borderColor = '';
copyBtn.style.color = '';
}, 2000);
};
messageDiv.appendChild(copyBtn);
} else {
const content = document.createElement('div');
content.style.fontSize = '14px';
content.style.lineHeight = '1.4';
const formatted = text
.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
.replace(/\*(.*?)\*/g, '<em>$1</em>')
.replace(/`(.*?)`/g, '<code>$1</code>')
.replace(/\n/g, '<br>');
content.innerHTML = formatted;
messageDiv.appendChild(content);
}

container.appendChild(messageDiv);

// FIX MOBILE: Timeout para garantir que o render terminou antes do scroll
setTimeout(() => {
container.scrollTop = container.scrollHeight;
}, 100);

if (sender === 'user' || sender === 'ai') {
floatChatHistory.push({ text, sender, model, timestamp: new Date().toISOString() });
if (!isPrivateMode) {
localStorage.setItem('mysword_float_chat_history', JSON.stringify(floatChatHistory));
}
}
}

function loadFloatChatHistory() {
const container = document.getElementById('float-chat-container');
container.innerHTML = '';
if (floatChatHistory.length === 0) {
addFloatMessage('‚ú® Ol√°! Sou o MySword AI, seu assistente teol√≥gico assembleiano. Escolha sua IA preferida acima e fa√ßa sua pergunta!', 'ai');
} else {
floatChatHistory.forEach(msg => addFloatMessage(msg.text, msg.sender, msg.model || 'gemini'));
}
}

function selectFloatPrompt(promptType) {
document.querySelectorAll('.float-quick-btn').forEach(btn => btn.classList.remove('selected'));
event.currentTarget.classList.add('selected');
selectedPrompt = promptType;
const indicator = document.getElementById('prompt-indicator');
indicator.textContent = `Modo: ${promptNames[promptType]}`;
indicator.className = 'prompt-indicator active';
const inputField = document.getElementById('float-user-input');
const currentValue = inputField.value.trim();
if (currentValue && !currentValue.startsWith(prompts[promptType]) && currentValue.length < 50) {
inputField.value = prompts[promptType] + currentValue;
}
inputField.focus();
}

function setActiveModel(model) {
activeModel = model;
updateModelButtons();
if (!isPrivateMode) {
localStorage.setItem('mysword_active_model', model);
}
if (!apiKeys[model] && model !== 'gemini') {
addFloatMessage(`‚ö†Ô∏è Nenhuma chave ${model.toUpperCase()} configurada. Clique em üîë para adicionar.`, 'ai');
}
}

function updateModelButtons() {
document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
document.querySelector(`.${activeModel}-btn`).classList.add('active');
}

// API KEYS - MODAL
function showApiModal() {
document.getElementById('api-modal').style.display = 'flex';
updateSavedKeysDisplay();
document.getElementById('gemini-key').value = apiKeys.gemini || '';
document.getElementById('mistral-key').value = apiKeys.mistral || '';
document.getElementById('deepseek-key').value = apiKeys.deepseek || '';
document.getElementById('groq-key').value = apiKeys.groq || '';
document.getElementById('api-modal').onclick = function(e) {
if (e.target === this) hideApiModal();
};
}

function hideApiModal() {
document.getElementById('api-modal').style.display = 'none';
}

function selectApiProvider(provider) {
apiProvider = provider;
document.querySelectorAll('.api-option').forEach(opt => opt.classList.remove('selected'));
document.querySelector(`.${provider}`).classList.add('selected');
document.getElementById('gemini-config').style.display = 'none';
document.getElementById('mistral-config').style.display = 'none';
document.getElementById('deepseek-config').style.display = 'none';
document.getElementById('groq-config').style.display = 'none';
document.getElementById(`${provider}-config`).style.display = 'block';
}

function updateSavedKeysDisplay() {
const container = document.getElementById('saved-keys-container');
container.innerHTML = '';
let hasKeys = false;
if (apiKeys.gemini) {
hasKeys = true;
container.innerHTML += `<div class="key-item"><span><strong>Gemini:</strong> <span class="key-preview">${apiKeys.gemini.substring(0,12)}...</span></span><span class="key-status status-valid">‚úì V√°lida</span></div>`;
}
if (apiKeys.mistral) {
hasKeys = true;
container.innerHTML += `<div class="key-item"><span><strong>Mistral:</strong> <span class="key-preview">${apiKeys.mistral.substring(0,12)}...</span></span><span class="key-status status-valid">‚úì V√°lida</span></div>`;
}
if (apiKeys.deepseek) {
hasKeys = true;
container.innerHTML += `<div class="key-item"><span><strong>DeepSeek:</strong> <span class="key-preview">${apiKeys.deepseek.substring(0,12)}...</span></span><span class="key-status status-valid">‚úì V√°lida</span></div>`;
}
if (apiKeys.groq) {
hasKeys = true;
container.innerHTML += `<div class="key-item"><span><strong>Llama:</strong> <span class="key-preview">${apiKeys.groq.substring(0,12)}...</span></span><span class="key-status status-valid">‚úì V√°lida</span></div>`;
}
if (!hasKeys) {
container.innerHTML = '<div class="key-item"><span>üîë Nenhuma chave configurada ainda</span></div>';
}
}

async function testApiKey(provider) {
const keyInput = document.getElementById(`${provider}-key`);
const key = keyInput.value.trim();
if (!key) { alert('‚ö†Ô∏è Insira uma chave primeiro!'); return; }
let isValid = false;
let message = '';
try {
if (provider === 'gemini') {
isValid = key.startsWith('AIzaSy');
message = isValid ? '‚úÖ Chave Gemini v√°lida!' : '‚ùå Chave inv√°lida. Deve come√ßar com "AIzaSy"';
} else if (provider === 'mistral') {
isValid = key.length > 20;
message = isValid ? '‚úÖ Chave Mistral v√°lida!' : '‚ùå Formato inv√°lido.';
} else if (provider === 'deepseek') {
isValid = key.startsWith('sk-') || key.length > 30;
message = isValid ? '‚úÖ Chave DeepSeek v√°lida!' : '‚ùå Formato inv√°lido.';
} else if (provider === 'groq') {
isValid = key.startsWith('gsk_') && key.length > 30;
message = isValid ? '‚úÖ Chave Groq v√°lida!' : '‚ùå Formato inv√°lido. Deve come√ßar com "gsk_"';
}
} catch (e) { message = `‚ùå Erro ao testar: ${e.message}`; }
alert(message);
if (isValid) {
apiKeys[provider] = key;
updateSavedKeysDisplay();
}
}

function saveAllApiKeys() {
apiKeys.gemini = document.getElementById('gemini-key').value.trim();
apiKeys.mistral = document.getElementById('mistral-key').value.trim();
apiKeys.deepseek = document.getElementById('deepseek-key').value.trim();
apiKeys.groq = document.getElementById('groq-key').value.trim();
if (!isPrivateMode) {
localStorage.setItem('mysword_api_keys', JSON.stringify(apiKeys));
}
updateSavedKeysDisplay();
hideApiModal();
if (apiKeys.gemini || apiKeys.mistral || apiKeys.deepseek || apiKeys.groq) {
addFloatMessage('‚úÖ Chaves salvas com sucesso! Escolha sua IA preferida nos bot√µes acima.', 'ai');
}
}

async function autoConfigAll() {
const btn = document.querySelector('.modal-btn.btn-primary[onclick="autoConfigAll()"]');
const originalText = btn.innerHTML;
btn.innerHTML = '‚è≥ Testando...';
btn.disabled = true;
const resultsContainer = document.getElementById('auto-config-results');
resultsContainer.innerHTML = '<div class="key-item"><span>‚è≥ Testando todas as chaves...</span></div>';
const geminiKey = document.getElementById('gemini-key').value.trim();
const mistralKey = document.getElementById('mistral-key').value.trim();
const deepseekKey = document.getElementById('deepseek-key').value.trim();
const groqKey = document.getElementById('groq-key').value.trim();
const results = {};
if (geminiKey) results.gemini = await testAndDiscoverGemini(geminiKey);
if (mistralKey) results.mistral = await testAndDiscoverMistral(mistralKey);
if (deepseekKey) results.deepseek = await testAndDiscoverDeepSeek(deepseekKey);
if (groqKey) results.groq = await testAndDiscoverGroq(groqKey);
updateAutoConfigResults(results);
btn.innerHTML = originalText;
btn.disabled = false;
}

async function testAndDiscoverGemini(apiKey) {
try {
const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
if (!response.ok) return { isValid: false, error: `HTTP ${response.status}` };
const data = await response.json();
if (data.models) {
const geminiModels = data.models.filter(m => m.name.includes("gemini") && m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent"));
if (geminiModels.length > 0) {
geminiModels.sort((a, b) => b.name.localeCompare(a.name));
const chosenModel = geminiModels[0].name.replace("models/", "");
discoveredModels.gemini = chosenModel;
return { isValid: true, model: chosenModel };
}
}
return { isValid: false, error: "Nenhum modelo Gemini encontrado." };
} catch (error) { return { isValid: false, error: error.message }; }
}

async function testAndDiscoverMistral(apiKey) {
try {
const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}`},
body: JSON.stringify({model: 'mistral-small-latest', messages: [{role: 'user', content: 'Test'}], max_tokens: 1})
});
if (!response.ok) return { isValid: false, error: `HTTP ${response.status}` };
discoveredModels.mistral = 'mistral-small-latest';
return { isValid: true, model: 'mistral-small-latest' };
} catch (error) { return { isValid: false, error: error.message }; }
}

async function testAndDiscoverDeepSeek(apiKey) {
try {
const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}`},
body: JSON.stringify({model: 'deepseek-chat', messages: [{role: 'user', content: 'Test'}], max_tokens: 1})
});
if (!response.ok) return { isValid: false, error: `HTTP ${response.status}` };
discoveredModels.deepseek = 'deepseek-chat';
return { isValid: true, model: 'deepseek-chat' };
} catch (error) { return { isValid: false, error: error.message }; }
}

async function testAndDiscoverGroq(apiKey) {
try {
const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}`},
body: JSON.stringify({model: 'llama-3.1-8b-instant', messages: [{role: 'user', content: 'Test'}], max_tokens: 1})
});
if (!response.ok) return { isValid: false, error: `HTTP ${response.status}` };
discoveredModels.groq = 'llama-3.1-8b-instant';
return { isValid: true, model: 'llama-3.1-8b-instant' };
} catch (error) { return { isValid: false, error: error.message }; }
}

function updateAutoConfigResults(results) {
const container = document.getElementById('auto-config-results');
if (!container) return;
let html = '';
for (const [provider, result] of Object.entries(results)) {
html += result.isValid ? `<div class="key-item"><span><strong>${provider.toUpperCase()}:</strong> ‚úÖ V√°lida | Modelo: ${result.model}</span></div>` : `<div class="key-item"><span><strong>${provider.toUpperCase()}:</strong> ‚ùå Erro: ${result.error}</span></div>`;
}
if (Object.keys(results).length === 0) html = '<div class="key-item"><span>‚ö†Ô∏è Nenhuma chave para testar</span></div>';
container.innerHTML = html;
}

async function sendFloatMessage() {
const input = document.getElementById('float-user-input');
const userText = input.value.trim();
if (!userText) return;

if (!apiKeys[activeModel]) {
addFloatMessage(`‚ö†Ô∏è Nenhuma chave ${activeModel.toUpperCase()} configurada.`, 'ai');
showApiModal();
return;
}

addFloatMessage(userText, 'user');
input.value = '';
if (selectedPrompt) {
document.querySelectorAll('.float-quick-btn').forEach(btn => btn.classList.remove('selected'));
selectedPrompt = '';
document.getElementById('prompt-indicator').className = 'prompt-indicator';
}

const container = document.getElementById('float-chat-container');
const loadingDiv = document.createElement('div');
loadingDiv.className = 'float-message float-ai-message';
loadingDiv.innerHTML = '<div class="message-header">‚öîÔ∏è MySword AI</div><div class="loading"><span></span><span></span><span></span></div>';
container.appendChild(loadingDiv);
setTimeout(() => { container.scrollTop = container.scrollHeight; }, 100);

try {
let responseText = '';
if (activeModel === 'gemini') responseText = await callGeminiAPI(userText);
else if (activeModel === 'mistral') responseText = await callMistralAPI(userText);
else if (activeModel === 'deepseek') responseText = await callDeepSeekAPI(userText);
else if (activeModel === 'groq') responseText = await callGroqAPI(userText);

container.removeChild(loadingDiv);
addFloatMessage(responseText, 'ai', activeModel);
} catch (error) {
if (container.contains(loadingDiv)) container.removeChild(loadingDiv);
addFloatMessage(`‚ùå Erro: ${error.message}`, 'ai', activeModel);
}
}

async function callGeminiAPI(userText) {
let fullPrompt = selectedPrompt ? `${defaultProfile}\n${modeGuidelines[selectedPrompt]}\nPergunta: ${userText}` : `${defaultProfile}\nPergunta: ${userText}`;
const modelName = discoveredModels.gemini || defaultModels.gemini;
const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent`, {
method: 'POST',
headers: {'Content-Type': 'application/json', 'x-goog-api-key': apiKeys.gemini},
body: JSON.stringify({contents: [{ parts: [{ text: fullPrompt }] }], generationConfig: {temperature: 0.7, maxOutputTokens: 2000}})
});
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.candidates?.[0]?.content?.parts?.[0]?.text || 'Erro na resposta';
}

async function callMistralAPI(userText) {
let fullPrompt = selectedPrompt ? `${defaultProfile}\n${modeGuidelines[selectedPrompt]}\nPergunta: ${userText}` : `${defaultProfile}\nPergunta: ${userText}`;
const modelName = discoveredModels.mistral || defaultModels.mistral;
const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKeys.mistral}`},
body: JSON.stringify({model: modelName, messages: [{role: 'user', content: fullPrompt}], temperature: 0.7})
});
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.choices?.[0]?.message?.content || 'Erro na resposta';
}

async function callDeepSeekAPI(userText) {
let fullPrompt = selectedPrompt ? `${defaultProfile}\n${modeGuidelines[selectedPrompt]}\nPergunta: ${userText}` : `${defaultProfile}\nPergunta: ${userText}`;
const modelName = discoveredModels.deepseek || defaultModels.deepseek;
const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKeys.deepseek}`},
body: JSON.stringify({model: modelName, messages: [{role: 'user', content: fullPrompt}], temperature: 0.7})
});
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.choices?.[0]?.message?.content || 'Erro na resposta';
}

async function callGroqAPI(userText) {
let fullPrompt = selectedPrompt ? `${defaultProfile}\n${modeGuidelines[selectedPrompt]}\nPergunta: ${userText}` : `${defaultProfile}\nPergunta: ${userText}`;
const modelName = discoveredModels.groq || defaultModels.groq;
const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
method: 'POST',
headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKeys.groq}`},
body: JSON.stringify({model: modelName, messages: [{role: 'user', content: fullPrompt}], temperature: 0.7})
});
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.choices?.[0]?.message?.content || 'Erro na resposta';
}

// SHORTCUTS & THEME
function toggleTheme() {
const isLight = document.body.classList.toggle('light-mode');
if (!isPrivateMode) localStorage.setItem('mysword_theme', isLight ? 'light' : 'dark');
}

function clearFloatChat() {
if (confirm('Limpar hist√≥rico do chat?')) {
floatChatHistory = [];
if (!isPrivateMode) localStorage.removeItem('mysword_float_chat_history');
loadFloatChatHistory();
}
}

document.addEventListener('keydown', function(e) {
if (e.ctrlKey && e.key === 'Enter') sendFloatMessage();
if (e.key === 'Escape') if (document.getElementById('api-modal').style.display === 'flex') hideApiModal();
});
</script>
</body>
</html>